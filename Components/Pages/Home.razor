@page "/"
@inject AppDbContext Db
@inject BlazorAuthService BlazorAuth

<PageTitle>Bokningssystem â€“ Hem</PageTitle>

<!-- Hero Section -->
<section class="hero-section">
    <div class="hero-content">
        <div class="hero-badge">ðŸŽ« Event Bokningssystem</div>
        <h1 class="hero-title">
            Hitta & Boka<br/>
            <span class="text-orange">Ditt NÃ¤sta Event</span>
        </h1>
        <p class="hero-subtitle">
            Boka biljetter till konserter, festivaler, tech-konferenser och mycket mer â€“
            enkelt, snabbt och sÃ¤kert.
        </p>
        <div class="hero-actions">
            <a href="/events" class="btn-hero-primary">Utforska Events â†’</a>
            @if (!BlazorAuth.IsAuthenticated)
            {
                <a href="/register" class="btn-hero-secondary">Skapa konto gratis</a>
            }
            else
            {
                <a href="/my-bookings" class="btn-hero-secondary">Mina Bokningar</a>
            }
        </div>
    </div>
    <div class="hero-visual">
        <div class="hero-card-float card-1">ðŸŽµ Sommarfestival 2025</div>
        <div class="hero-card-float card-2">ðŸŽ· Jazz Evening</div>
        <div class="hero-card-float card-3">ðŸ’» Tech Conference</div>
    </div>
</section>

<!-- Stats Bar -->
<section class="stats-bar">
    <div class="stat-item">
        <div class="stat-number text-orange">@eventCount</div>
        <div class="stat-label">Events</div>
    </div>
    <div class="stat-divider"></div>
    <div class="stat-item">
        <div class="stat-number text-green">@upcomingCount</div>
        <div class="stat-label">Kommande</div>
    </div>
    <div class="stat-divider"></div>
    <div class="stat-item">
        <div class="stat-number text-orange">@venueCount</div>
        <div class="stat-label">Venues</div>
    </div>
    <div class="stat-divider"></div>
    <div class="stat-item">
        <div class="stat-number text-green">@bookingCount</div>
        <div class="stat-label">Bokningar</div>
    </div>
</section>

<!-- Upcoming Events Preview -->
<section class="section-container">
    <div class="section-header">
        <h2 class="section-title">Kommande Events</h2>
        <a href="/events" class="link-see-all">Visa alla â†’</a>
    </div>

    @if (upcomingEvents is null)
    {
        <div class="loading-spinner"><div class="spinner-ring"></div></div>
    }
    else
    {
        <div class="events-preview-grid">
            @foreach (var e in upcomingEvents)
            {
                <EventCard Event="@e" />
            }
        </div>
    }
</section>

<!-- Auth CTA -->
@if (!BlazorAuth.IsAuthenticated)
{
    <section class="cta-section">
        <div class="cta-content">
            <h2 class="cta-title">Redo att boka?</h2>
            <p class="cta-subtitle">Skapa ett gratis konto och bÃ¶rja boka biljetter pÃ¥ sekunder.</p>
            <div class="cta-actions">
                <a href="/register" class="btn-hero-primary">Registrera gratis</a>
                <a href="/login" class="btn-hero-secondary">Logga in</a>
            </div>
        </div>
    </section>
}

@code {
    private int eventCount, upcomingCount, venueCount, bookingCount;
    private List<Models.Event>? upcomingEvents;

    protected override async Task OnInitializedAsync()
    {
        eventCount = await Db.Events.CountAsync();
        upcomingCount = await Db.Events.CountAsync(e => e.Date > DateTime.UtcNow);
        venueCount = await Db.Venues.CountAsync();
        bookingCount = await Db.Bookings.CountAsync(b => !b.IsCancelled);

        upcomingEvents = await Db.Events
            .Include(e => e.Venue)
            .Include(e => e.Tickets)
            .Where(e => e.Date > DateTime.UtcNow)
            .OrderBy(e => e.Date)
            .Take(3)
            .ToListAsync();
    }
}
