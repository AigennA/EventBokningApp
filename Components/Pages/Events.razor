@page "/events"
@inject AppDbContext Db

<PageTitle>Events â€“ Bokningssystem</PageTitle>

<div class="page-header">
    <div>
        <h1 class="page-title">Alla Events</h1>
        <p class="page-subtitle">Hitta och boka biljetter till ditt nÃ¤sta evenemang</p>
    </div>
    <div class="filter-controls">
        <button class="filter-btn @(showUpcomingOnly ? "filter-btn-active" : "")"
                @onclick="ToggleFilter">
            @(showUpcomingOnly ? "ğŸ“… Kommande" : "ğŸ“‹ Alla events")
        </button>
    </div>
</div>

@if (events is null)
{
    <div class="loading-spinner">
        <div class="spinner-ring"></div>
        <p>HÃ¤mtar events...</p>
    </div>
}
else if (!events.Any())
{
    <div class="empty-state">
        <div class="empty-icon">ğŸª</div>
        <h3>Inga events hittades</h3>
        <p>Inga events att visa just nu. Kom tillbaka senare!</p>
    </div>
}
else
{
    <div class="events-grid">
        @foreach (var e in events)
        {
            <EventCard Event="@e" />
        }
    </div>
}

@code {
    private List<Models.Event>? events;
    private bool showUpcomingOnly = false;

    protected override async Task OnInitializedAsync() => await LoadEvents();

    private async Task ToggleFilter()
    {
        showUpcomingOnly = !showUpcomingOnly;
        await LoadEvents();
    }

    private async Task LoadEvents()
    {
        var query = Db.Events.Include(e => e.Venue).Include(e => e.Tickets).AsQueryable();
        if (showUpcomingOnly)
            query = query.Where(e => e.Date > DateTime.UtcNow);
        events = await query.OrderBy(e => e.Date).ToListAsync();
    }
}
